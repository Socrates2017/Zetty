function search(){var b=$("#searchKey").val();var a="/article/search?q="+b;window.open(a);return false}var fChkMail=function(b){var c=/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/;var a=c.test(b);return a};$("#register-email").blur(function(){var b=$("#register-email").val();if(fChkMail(b)){var a={};a.email=b;$.ajax({url:"/user/checkEmail",type:"POST",cache:false,contentType:"application/json;charset=utf-8",datatype:"json",data:JSON.stringify(a),success:function(c){if(c.code==10000){$("#div-email").addClass("has-success has-feedback");$("#register-email").after("<span class='glyphicon glyphicon-ok form-control-feedback' aria-hidden='true'></span>");$("#div-email").removeClass("has-error");$("#div-email span").remove(".glyphicon-remove")}else{$("#div-email").addClass("has-error has-feedback");$("#register-email").after("<span class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>");$("#div-email").removeClass("has-success");$("#div-email span").remove(".glyphicon-ok")}}})}else{$("#div-email").addClass("has-error has-feedback");$("#register-email").after("<span class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>");$("#div-email").removeClass("has-success");$("#div-email span").remove(".glyphicon-ok")}});$("#register-nickName").blur(function(){var a=$("#register-nickName").val();if(a!=undefined&&a!=""){$("#div-nickName").addClass("has-success has-feedback");$("#register-nickName").after("<span class='glyphicon glyphicon-ok form-control-feedback' aria-hidden='true'></span>");$("#div-nickName").removeClass("has-error");$("#div-nickName span").remove(".glyphicon-remove")}else{$("#div-nickName").addClass("has-error has-feedback");$("#register-nickName").after("<span class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>");$("#div-nickName").removeClass("has-success");$("#div-nickName span").remove(".glyphicon-ok")}});$("#password1").blur(function(){var a=$("#password1").val();if(a!=undefined&&a.length>5){$("#div-password1").addClass("has-success has-feedback");$("#password1").after("<span class='glyphicon glyphicon-ok form-control-feedback' aria-hidden='true'></span>");$("#div-password1").removeClass("has-error");$("#div-password1 span").remove(".glyphicon-remove")}else{$("#div-password1").addClass("has-error has-feedback");$("#password1").after("<span class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>");$("#div-password1").removeClass("has-success");$("#div-password1 span").remove(".glyphicon-ok")}});$("#password2").blur(function(){var b=$("#password1").val();var a=$("#password2").val();if(a!=undefined&&b.length>5&&b==a){$("#div-password2").addClass("has-success has-feedback");$("#password2").after("<span class='glyphicon glyphicon-ok form-control-feedback' aria-hidden='true'></span>");$("#div-password2").removeClass("has-error");$("#div-password2 span").remove(".glyphicon-remove")}else{$("#div-password2").addClass("has-error has-feedback");$("#password2").after("<span class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>");$("#div-password2").removeClass("has-success");$("#div-password2 span").remove(".glyphicon-ok")}});$("#register-authCode").blur(function(){var b=$("#register-authCode").val();if(b!=undefined&&b!=""){var a={};a.authCode=b;$.ajax({url:"/checkAuthCode",type:"POST",cache:false,contentType:"application/json;charset=utf-8",datatype:"json",data:JSON.stringify(a),success:function(c){if(c.code==10000){$("#div-authCode").addClass("has-success has-feedback");$("#register-authCode").after("<span class='glyphicon glyphicon-ok form-control-feedback' aria-hidden='true'></span>");$("#div-authCode").removeClass("has-error");$("#div-authCode span").remove(".glyphicon-remove")}else{$("#div-authCode").addClass("has-error has-feedback");$("#register-authCode").after("<span class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>");$("#div-authCode").removeClass("has-success");$("#div-authCode span").remove(".glyphicon-ok")}}})}else{$("#div-authCode").addClass("has-error has-feedback");$("#register-authCode").after("<span class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>");$("#div-authCode").removeClass("has-success");$("#div-authCode span").remove(".glyphicon-ok")}});$("#login-authCode").blur(function(){checkloginauthCode()});function checkloginauthCode(){var b=$("#login-authCode").val();if(b!=undefined&&b!=""){var a={};a.authCode=b;$.ajax({url:"/checkAuthCode",type:"POST",cache:false,contentType:"application/json;charset=utf-8",datatype:"json",data:JSON.stringify(a),success:function(c){if(c.code==10000){$("#div-authCode-login").addClass("has-success has-feedback");$("#login-authCode").after("<span class='glyphicon glyphicon-ok form-control-feedback' aria-hidden='true'></span>");$("#div-authCode-login").removeClass("has-error");$("#div-authCode-login span").remove(".glyphicon-remove")}else{if(c.code==50101){$("#div-authCode-login").addClass("has-error has-feedback");$("#login-authCode").after("<span class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>");$("#div-authCode-login").removeClass("has-success");$("#div-authCode-login span").remove(".glyphicon-ok")}else{console.error("")}}}})}else{$("#div-authCode-login").addClass("has-error has-feedback");$("#login-authCode").after("<span class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>");$("#div-authCode-login").removeClass("has-success");$("#div-authCode-login span").remove(".glyphicon-ok")}}function register(){var d=$("#div-email span").attr("class");if(d.indexOf("glyphicon-remove")>0){alert("邮箱已注册");return false}var i=$("#div-nickName span").attr("class");if(i.indexOf("glyphicon-remove")>0){alert("昵称不能为空");return false}var b=$("#div-password2 span").attr("class");if(b.indexOf("glyphicon-remove")>0){alert("两次输入的密码不一致");return false}var h=$("#div-authCode span").attr("class");if(h.indexOf("glyphicon-remove")>0){alert("验证码不正确");return false}var e=$("#register-email").val();var f=$("#register-nickName").val();var g=$("#password1").val();var c=$("#register-authCode").val();var a={};a.email=e;a.name=f;a.password=g;a.authCode=c;showReflesh();$.ajax({url:"/user/register",type:"post",contentType:"application/json;charset=utf-8",datatype:"json",data:JSON.stringify(a),success:function(j){removeReflesh();if(j.code==10000){$.MsgBox.Confirm("提示","已发送一封激活邮件到您的邮箱，请打开邮箱确认！",function(){$("#register").modal("hide")})}else{$.MsgBox.Confirm("提示",j.message,function(){console.log("注册异常")})}}})}function login(){var a=$("#div-authCode-login span").attr("class");if(a.indexOf("glyphicon-remove")>0){return false}var d=$("#login-email").val();var c=$("#login-password").val();var e=$("#login-authCode").val();var b={};b.email=d;b.password=c;b.authCode=e;showReflesh();$.ajax({url:"/user/login",type:"post",contentType:"application/json;charset=utf-8",datatype:"json",data:JSON.stringify(b),success:function(f){removeReflesh();if(f.code==10000){$("#login").modal("hide");refreshPcrimg("checkLogin")}else{$.MsgBox.Confirm("提示",f.message,function(){console.log("登录失败")})}}})}function logout(){var a={};$.ajax({url:"/user/logout",type:"post",contentType:"application/json;charset=utf-8",datatype:"json",data:JSON.stringify(a),success:function(b){if(b.code==10000){location.reload(true)}else{$.MsgBox.Confirm("提示",b.message,function(){console.log("退出失败")})}}})}function refreshPcrimg(b){var a="/pcrimg";$.get(a,function(c){console.log("刷新验证码！");$("#img-authCode-login").attr("src",a);$("#img-authCode-register").attr("src",a);if($.isBlank(b)){}else{window[b].call(this)}})}function checkLogin(){$.ajax({url:"/user/checkLogin",type:"GET",datatype:"json",async:true,success:function(a){var d=a.code;if((d==40101)||(d==40102)){console.log("session缺失");refreshPcrimg()}else{if(d==10000){var b=a.data;var c="";c+='<li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"> <img id="sm-name" src="';if($.isBlank(b.headImg)){c+='/static/img/default_headImg.jpg"'}else{c+=b.headImg}c+='class="center-block img-circle" alt="图片无效"></a><ul class="dropdown-menu"><li><a href="';c+="/user/center/"+b.id+'" target="_blank">';c+=b.name+'<span class="glyphicon glyphicon-cog"></span></a> <a onclick="logout()"> 退出登录 <span class="glyphicon glyphicon-off"></span></a></li></ul></li>';$("#userCenterUl").html(c)}else{if(d==40103){console.log("未登录")}else{console.log("检查登录异常")}}}}})}function addArticle(){var e=$("#title").val();var d=$("#content").val();var a=$("input[name=article-status]:checked").val();if(e==""){$.MsgBox.Confirm("提示","标题不能为空！",function(){});return false}if($("#content").val()==""){$.MsgBox.Confirm("提示","内容不能为空！",function(){});return false}var c=d.replace(/\r/g,"");if(c!=""){c="<p>"+c.replace(/\n*$/g,"").replace(/\n/g,"</p><p>")+"</p>";var b={};b.title=e;b.content=c;b.status=a;showReflesh();$.ajax({url:"/article/add",type:"POST",contentType:"application/json;charset=utf-8",dataType:"json",data:JSON.stringify(b),success:function(f){removeReflesh();if(f.code==10000){$.MsgBox.Confirm("提示","发布成功！",function(){});toSearch(null)}else{$.MsgBox.Confirm("提示",f.message,function(){})}},error:function(){removeReflesh();$.MsgBox.Confirm("提示","系统异常，稍后重试",function(){})}})}}function questionListFromLucene(b,a){$.ajax({url:"/getQuestionListFromLucene?pageIndex="+b+"&tag="+a,type:"GET",contentType:"application/json;charset=utf-8",datatype:"json",async:true,success:function(c){$("#pagetable").empty();$("#pageNav").empty();var f="";var d=c.respData.pageNav;var g=c.respData.questions;for(var e=0;e<g.length;e++){f+='<a href="/question/'+g[e].id+'" target="_blank" style="font-weight:bold;">'+g[e].title+"</a>";f+='<div style="float:right;font-size:12px;color:#888888;">'+g[e].createdTimeStr+"</div>";f+="<hr>"}$("#pagetable").append(f);$("#pageNav").append(d)}})}function tableList(a,f,e,b){showReflesh();try{var c="/article/page?pageNum="+e+"&pageSide="+b+"&tag="+a;$.ajax({url:c,type:"GET",datatype:"json",success:function(g){try{showDataDiv(g,f)}catch(h){}finally{removeReflesh()}},error:function(){removeReflesh();$.MsgBox.Confirm("提示","系统繁忙，请重试",function(){})}})}catch(d){}}function showDataDiv(n,d){var e=n.data.data;var b=n.data.pageNum;var m=n.data.pageSide;var g="";for(var f=0;f<e.length;f++){var k=e[f];var a=k.id;var l=k.title;var j=new Date(k.ctime).Format("yyyy-MM-dd");var c=k.username;var h=(b-1)*m+parseInt(f)+1;g+='<a href="/article/detail/'+a+'" target="_blank" style="font-weight:bold;">'+l+"</a>";g+='<div style="float:right;font-size:12px;color:#888888;">'+j+"</div>";g+="<hr>"}$("#"+d).html(g)}function toSearch(g){showReflesh();try{var h=1;var a=$(g);var j=a.html();if(null!=g){h=parseInt(j)}var c=$(".active");var b=1;if(undefined!=c){b=parseInt(c.html());c.removeClass("active")}if(null==g){var i='<ul class="pagination"><li><a href="#" onclick="toSearch(this);return false;">«</a></li><li><a class ="active" href="#" onclick="toSearch(this);return false;">'+h+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h+1)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h+2)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h+3)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h+4)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">»</a></li></ul>';$("#foot").html(i)}else{if("«"==j){h=b-1;if(h>5){var i='<ul class="pagination"><li><a href="#" onclick="toSearch(this);return false;">«</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h-4)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h-3)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h-2)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h-1)+'</a></li><li><a class ="active" href="#" onclick="toSearch(this);return false;">'+h+'</a></li><li><a href="#" onclick="toSearch(this);return false;">»</a></li></ul>';$("#foot").html(i)}else{var i='<ul class="pagination"><li><a href="#" onclick="toSearch(this);return false;">«</a></li><li><a';if(2>h){i+=' class ="active"';h=1}i+=' href="#" onclick="toSearch(this);return false;">'+1+"</a></li><li><a";if(2==h){i+=' class ="active"'}i+=' href="#" onclick="toSearch(this);return false;">'+2+"</a></li><li><a";if(3==h){i+=' class ="active"'}i+=' href="#" onclick="toSearch(this);return false;">'+3+"</a></li><li><a";if(4==h){i+=' class ="active"'}i+=' href="#" onclick="toSearch(this);return false;">'+4+"</a></li><li><a";if(5==h){i+=' class ="active"'}i+=' href="#" onclick="toSearch(this);return false;">'+5+'</a></li><li><a href="#" onclick="toSearch(this);return false;">»</a></li></ul>';$("#foot").html(i)}}else{if("»"==j){h=b+1;var i='<ul class="pagination"><li><a href="#" onclick="toSearch(this);return false;">«</a></li><li><a class ="active" href="#" onclick="toSearch(this);return false;">'+h+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h+1)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h+2)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h+3)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">'+(h+4)+'</a></li><li><a href="#" onclick="toSearch(this);return false;">»</a></li></ul>';$("#foot").html(i)}else{a.addClass("active")}}}var f="tableList";var k=$(".activeTag").html();if($.isBlank(k)||"全部"==k){k=""}tableList(k,f,h,20)}catch(d){}finally{removeReflesh()}}function changeTag(a){$(".tagList").each(function(){$(this).removeClass("activeTag")});$(a).addClass("activeTag");toSearch(null)}function allTags(){try{var a="/tag/all";$.ajax({url:a,type:"GET",datatype:"json",success:function(d){if(d.code==10000){var g=d.data;var f='<button class="button tagList" id="id全部" onclick="changeTag(this);"style="height: 30px; font-size: 14px;">全部</button>';for(var e in g){var c=g[e];f+='<button class="button tagList" id="id'+c+'" onclick="changeTag(this);"style="height: 30px; font-size: 14px;">'+c+"</button>"}$("#tagList").html(f)}else{$.MsgBox.Confirm("提示",d.message,function(){})}},error:function(){$.MsgBox.Confirm("提示","系统繁忙，请重试",function(){})}})}catch(b){}finally{}}function bookList(){try{var a="/book/infoList";$.ajax({url:a,type:"GET",datatype:"json",success:function(c){if(c.code==10000){var g=c.data;var f="";for(var e in g){var d=g[e];f+='<a href="/book/'+d.id+'" target="_blank" style="font-size: 20px">《'+d.name+'》</a>&emsp;<a href="/user/center/'+d.creatorId+'" target="_blank" style="font-size: 20px">'+d.creator+'</a><p style="font-size: 16px;background: #F8F8FF">'+d.description+"</p>"}$("#bookList").html(f)}else{$.MsgBox.Confirm("提示",c.message,function(){})}},error:function(){$.MsgBox.Confirm("提示","系统繁忙，请重试",function(){})}})}catch(b){}finally{}}function showAddBookModal(){$.ajax({url:"/user/checkLogin",type:"GET",datatype:"json",async:true,success:function(a){var b=a.code;if(b==10000){$("#addBookModal").modal("show")}else{$.MsgBox.Confirm("提示","请先登录！",function(){})}}})}function addBook(){var b=$("#book-name").val();var c=$("#book-description").val();if($.isBlank(b)){$.MsgBox.Confirm("提示","错误：name 为空！",function(){});return false}if($.isBlank(c)){$.MsgBox.Confirm("提示","错误：description 为空！",function(){});return false}var a={};a.name=b;a.description=c;showReflesh();$.ajax({url:"book/add",type:"POST",contentType:"application/json;charset=utf-8",dataType:"json",data:JSON.stringify(a),success:function(d){removeReflesh();if(d.code==10000){$.MsgBox.Confirm("提示","新增成功！",function(){});bookList()}else{$.MsgBox.Confirm("提示",d.message,function(){})}$("#addBookModal").modal("hide")},error:function(){removeReflesh();$("#addBookModal").modal("hide");$.MsgBox.Confirm("提示","系统异常，稍后重试",function(){})}})}$(function(){var a=document.getElementById("content");autoTextarea(a);refreshPcrimg("checkLogin");allTags();toSearch(null);bookList()});